---
title: "baipishu"
author: "marshall ma"
date: "7/10/2020"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r tools, include=FALSE}
#manipulation and cleaning
library(tidyr)
library(plyr)
library(stringr)
library(lubridate)
library(data.table)
library(dplyr)

#visualization
library(psych)
library(naniar)
library(arsenal)
library(ggcorrplot)
library(ggplot2)
```
```{r import, include=FALSE}
data <- read.csv("~/Documents/2020_2Summer/research/0Yale2009/data/output/bps_df0722_xm0725.csv", comment.char="#", encoding = "UTF-8")

head(data)
```



```{r transformation, include=FALSE}
data_vis <- data %>% 
  mutate(age_grp = ifelse(Age >= 25, "25+", "below25"), 
         gender_grp = ifelse(Gender == 1, "Male", 
                      ifelse(Gender == 2, "Female", 
                      ifelse(Gender < 667, "Spectrum", NA))), 
         degree_grp = ifelse(Degree == 1, "本科", 
                      ifelse(Degree == 2, "硕士", 
                      ifelse(Degree == 3, "MBA", 
                      ifelse(Degree == 4, "博士", NA)))),
         religion_grp = ifelse(Religion %in% c(1,2,3,4,5), "教", 
                      ifelse(Religion == 6, "无宗教信仰", NA)),
         gpa_grp = ifelse(GPA == 1, "a.3.8+", 
                      ifelse(GPA == 2, "b.3.5-3.8", 
                      ifelse(GPA == 3, "c.3.3-3.5", 
                      ifelse(GPA == 4, "d.3.0-3.3", 
                      ifelse(GPA == 5, "e.3-", NA))))),
         gpa_change_grp = ifelse(GradeChange == 1, "a明显变好", 
                      ifelse(GradeChange == 2, "b变好", 
                      ifelse(GradeChange == 3, "c不变", 
                      ifelse(GradeChange == 4, "d变差", 
                      ifelse(GradeChange == 5, "e明显变差", NA))))),
         
         MEMS_3 = MEMS1 + MEMS2 + MEMS3,
         
         #sometime
         time_new = ymd_hms(TimeSubmit), time_day = as.Date(TimeSubmit),
         ICE = ifelse(time_new <= as.POSIXct("2020-07-06 05"), "beforeICE", 
               ifelse(time_new >= as.Date("2020-07-14 05"), "postICE", "duringICE"))
        ) 


```

##Stage II: Overview    
      |  demo   |   MH exp |    
PWB   |   x     |     x    
Latent|   x     |     x    
Spec  |   x     |     x    
MH exp|   x     |    



