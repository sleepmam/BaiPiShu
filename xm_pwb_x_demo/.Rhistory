summary(table_y1, title = "demo By Service", text = TRUE)
table_y1 <- tableby(age_grp ~ GAD_sum, data = data_vis)
summary(table_y1, title = "demo By Service", text = TRUE)
table_y1 <- tableby(age_grp ~ GAD_sum + PHQ_sum, data = data_vis)
summary(table_y1, title = "demo By Service", text = TRUE)
table_y1 <- tableby(gender_grp ~ GAD_sum + PHQ_sum, data = data_vis)
summary(table_y1, title = "demo By Service", text = TRUE)
table_y1 <- tableby(religion_grp ~ GAD_sum + PHQ_sum, data = data_vis)
summary(table_y1, title = "demo By Service", text = TRUE)
table_y1 <- tableby(religion_grp + gender_grp ~ GAD_sum + PHQ_sum, data = data_vis)
typeof(data_vis$TimeSubmit)
head(data_vis$TimeSubmit)
library(lubridate)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit))
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
select(time_new, TimeSubmit)
head(data_date)
data_date <- data_vis %>%
mutate(time_new = ymd(TimeSubmit)) %>%
select(time_new, TimeSubmit)
head(data_date)
data_date <- data_vis %>%
mutate(time_new = ymd(TimeSubmit)) %>%
select(time_new, TimeSubmit)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
select(time_new, TimeSubmit) %>%
arrange(desc(time_new))
head(data_date)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
select(time_new, TimeSubmit) %>%
arrange(desc(time_new)) %>%
filter(time_new >= as.Date("2020-07-06") & time_new <= as.Date("2020-07-14"))
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
select(time_new, TimeSubmit) %>%
filter(time_new >= as.Date("2020-07-06") & time_new <= as.Date("2020-07-14"))
head(data_date)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
mutate(ICE = ifelse(time_new <= as.Date("2020-07-06"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE")))
head(data_date)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
mutate(ICE = ifelse(time_new <= as.Date("2020-07-06"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE"))) %>%
gather(PWB, PWB_val, PSS_sum:QLES_sum)
head(data_date)
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="Set3"))
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="Set3")
ggplot(data_date, aes(y = PHQ_sum, x = time_new))+ geom_point()
ggplot(data_vis, aes(y = PHQ_sum, x = TimeSubmit))+ geom_point()
ggplot(data_vis, aes(y = PHQ_sum, x = TimeSubmit)) + geom_count() + scale_size_area(max_size = 1)
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="Set3")
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="Greys")
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YIGn")
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlGn")
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr")
table_test <- tableby(ICE ~ PHQ_sum + GAD_sum + PSS_sum + SWLS_sum + QLES_sum + SCOFF_nervosa, data = data_vis)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
mutate(ICE = ifelse(time_new <= as.Date("2020-07-06"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE")))
data_date_g <- data_date %>%
gather(PWB, PWB_val, PSS_sum:QLES_sum)
table_test <- tableby(ICE ~ PHQ_sum + GAD_sum + PSS_sum + SWLS_sum + QLES_sum + SCOFF_nervosa, data = data_date_g)
ggplot(data_vis, aes(y = PHQ_sum, x = TimeSubmit)) + geom_count() + scale_size_area(max_size = 1)
table_test <- tableby(ICE ~ PHQ_sum + GAD_sum + PSS_sum + SWLS_sum + QLES_sum + SCOFF_nervosa, data = data_date_g)
summary(table_test, title = "test", text = TRUE)
table_test <- tableby(ICE ~ PHQ_sum + GAD_sum + PSS_sum + SWLS_sum + QLES_sum + SCOFF_nervosa, data = data_date)
summary(table_test, title = "test", text = TRUE)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit), time_day = ymd(TimeSubmit)) %>%
mutate(ICE = ifelse(time_new <= as.Date("2020-07-06"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE")))
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit), time_day = day(TimeSubmit)) %>%
mutate(ICE = ifelse(time_new <= as.Date("2020-07-06"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE")))
head(time_day)
ggplot(data_date_g, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBu")
ggplot(data_date_g, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlGnBu")
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit), time_day = date(TimeSubmit)) %>%
mutate(ICE = ifelse(time_new <= as.Date("2020-07-06"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE")))
head(time_day)
head(data_date)
ggplot(data_date, aes(y = PHQ_sum, x = time_day)) + geom_count() + scale_size_area(max_size = 1)
ggplot(data_date, aes(y = PHQ_sum, x = time_day)) + geom_count() + scale_size_area(max_size = 3)
ggplot(data_date, aes(y = PHQ_sum, x = time_day)) + geom_count() + scale_size_area(max_size = 3) + geom_vline(xintercept = 5)
ggplot(data_date, aes(y = PHQ_sum, x = time_day, fill = ICE)) + geom_count() + scale_size_area(max_size = 3)
ggplot(data_date, aes(y = PHQ_sum, x = time_day, fill = ICE)) + geom_count() + scale_size_area(max_size = 3) + scale_fill_brewer(palette="YlOrBr")
ggplot(data_date, aes(y = PHQ_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 3) + scale_fill_brewer(palette="YlOrBr")
ggplot(data_date, aes(y = PHQ_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 4)
ggplot(data_date, aes(y = QLES_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 4)
ggplot(data_date, aes(y = QLES_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 2.5)
ggplot(data_date, aes(y = QLES_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 3)
ggplot(data_date, aes(y = PSS_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 3)
head(data$TimeComplete)
check <- data %>%
mutate(
qc_idx = 0,
qc_idx = ifelse(TimeComplete < 600, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum == 0 & PHQ10 != 999, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum > 0 & PHQ10 == 999, qc_idx + 1, qc_idx)
#没有使用心理咨询等服务却选了满意度（没有选“不适用”）。
#C5 age match
#6 29.7 (QLES2) high should correspond to -> 28b1-6 low
#7 29.8 (QLES3) high should correspond to -> 29.1-5 high
#8 29.8 (QLES3) high should correspond to -> 29.6-7 medium to high
)
summary(check$qc_idx)
which(check$qc_idx == 2)
which(check$qc_idx > 0)
library(psych)
install.packages("psych")
#manipulation and cleaning
library(dplyr)
library(tidyr)
library(stringr)
library(lubridate)
library(data.table)
#visualization
library(psych)
library(naniar)
library(arsenal)
library(ggcorrplot)
library(ggplot2)
data <- read.csv("~/Documents/2020_2Summer/research/0Yale2009/data/output/bps_df0722_xm0722.csv", comment.char="#", encoding = "UTF-8")
head(data)
test <- data %>%
mutate(PSS_pos = (PSS1 + PSS2 + PSS3 + PSS4 + PSS5 + PSS6) / 6,
PSS_neg = (PSS7 + PSS8 + PSS9 + PSS10) / 4)
View(test)
summary(test$PSS_pos)
summary(test$PSS_neg)
test <- data %>%
mutate(PSS_pos = (PSS1 + PSS2 + PSS3 + PSS4 + PSS5 + PSS6) / 6,
PSS_neg = (PSS7 + PSS8 + PSS9 + PSS10) / 4,
PSS_usual = PSS_pos + PSS_neg,
PSS_reverse = PSS_pos + 4 - PSS_neg)
summary(test$PSS_usual)
summary(test$PSS_reverse)
hist(test$PSS_pos)
hist(test$PSS_neg)
hist(test$PSS_pos)
hist(test$PSS_usual)
hist(test$PSS_reverse)
test <- data %>%
mutate(PSS_pos = (PSS1 + PSS2 + PSS3 + PSS4 + PSS5 + PSS6) / 6,
PSS_neg = (PSS7 + PSS8 + PSS9 + PSS10) / 4,
PSS_usual = PSS_pos - PSS_neg,
PSS_reverse = PSS_pos - 4 + PSS_neg)
hist(test$PSS_usual)
hist(test$PSS_reverse)
summary(test$PSS_usual)
summary(test$PSS_reverse)
hist(test$PSS_usual)
sd(test$PSS_usual)
which(abs(test$PSS_usual) > 2.4 )
check <- data %>%
mutate(
qc_idx = 0,
qc_idx = ifelse(TimeComplete < 600, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum == 0 & PHQ10 != 999, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum > 0 & PHQ10 == 999, qc_idx + 1, qc_idx)
#没有使用心理咨询等服务却选了满意度（没有选“不适用”）。
#C5 age match
#6 29.7 (QLES2) high should correspond to -> 28b1-6 low
#7 29.8 (QLES3) high should correspond to -> 29.1-5 high
#8 29.8 (QLES3) high should correspond to -> 29.6-7 medium to high
)
which(check$qc_idx > 0)
check <- data %>%
mutate(
qc_idx = 0,
qc_idx = ifelse(TimeComplete < 600, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum == 0 & PHQ10 != 999, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum > 0 & PHQ10 == 999, qc_idx + 1, qc_idx),
PSS_pos = (PSS1 + PSS2 + PSS3 + PSS4 + PSS5 + PSS6) / 6,
PSS_neg = (PSS7 + PSS8 + PSS9 + PSS10) / 4,
PSS_usual = PSS_pos - PSS_neg,
qc_idx = ifelse(abs(PSS_usual - mean(PSS_usual)) > 3* sd(PSS_usual), qc_idx + 1, qc_idx)
#没有使用心理咨询等服务却选了满意度（没有选“不适用”）。
#C5 age match
#6 29.7 (QLES2) high should correspond to -> 28b1-6 low
#7 29.8 (QLES3) high should correspond to -> 29.1-5 high
#8 29.8 (QLES3) high should correspond to -> 29.6-7 medium to high
)
summary(check$qc_idx)
which(check$qc_idx > 2)
which(check$qc_idx > 1)
which(check$qc_idx == 2)
which(check$qc_idx == 3)
head(data$Service)
(2 | 3) != 1
(1 | 3) != 1
(1 | 1) != 1
(1 | 1)
(2 != 1| 3!= 1)
check <- data %>%
mutate(
qc_idx = 0,
qc_idx = ifelse(TimeComplete < 600, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum == 0 & PHQ10 != 999, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum > 0 & PHQ10 == 999, qc_idx + 1, qc_idx),
PSS_dif = (PSS1 + PSS2 + PSS3 + PSS4 + PSS5 + PSS6) / 6 - (PSS7 + PSS8 + PSS9 + PSS10) / 4,
qc_idx = ifelse(abs(PSS_dif - mean(PSS_dif)) > 3*sd(PSS_dif), qc_idx + 1, qc_idx),
qc_idx = ifelse(Service == 2 & (ServSat_Med != 1 | ServSat_Ind != 1 | ServSat_Grp != 1 | ServSat_Inp != 1 | ServSat_Cri != 1) , qc_idx + 1, qc_idx)
#没有使用心理咨询等服务却选了满意度（没有选“不适用”）。
#C5 age match
#6 29.7 (QLES2) high should correspond to -> 28b1-6 low
#7 29.8 (QLES3) high should correspond to -> 29.1-5 high
#8 29.8 (QLES3) high should correspond to -> 29.6-7 medium to high
)
summary(check$qc_idx)
which(check$qc_idx == 3)
which(check$qc_idx == 4)
which(check$qc_idx == 2)
which(check$qc_idx == 1)
head(data$ServSat_Med)
summary(data$ServSat_Med)
check <- data %>%
mutate(
qc_idx = 0,
qc_idx = ifelse(TimeComplete < 600, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum == 0 & PHQ10 != 999, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum > 0 & PHQ10 == 999, qc_idx + 1, qc_idx),
PSS_dif = (PSS1 + PSS2 + PSS3 + PSS4 + PSS5 + PSS6) / 6 - (PSS7 + PSS8 + PSS9 + PSS10) / 4,
qc_idx = ifelse(abs(PSS_dif - mean(PSS_dif)) > 3*sd(PSS_dif), qc_idx + 1, qc_idx),
qc_idx = ifelse(Service == 2 & (ServSat_Med + ServSat_Ind + ServSat_Grp + ServSat_Inp + ServSat_Cri > 0) , qc_idx + 1, qc_idx)
#没有使用心理咨询等服务却选了满意度（没有选“不适用”）。
#C5 age match
#6 29.7 (QLES2) high should correspond to -> 28b1-6 low
#7 29.8 (QLES3) high should correspond to -> 29.1-5 high
#8 29.8 (QLES3) high should correspond to -> 29.6-7 medium to high
)
summary(check$qc_idx)
which(check$qc_idx == 1)
which(check$qc_idx == 3)
which(data$Service == 2 & (data$ServSat_Med + data$ServSat_Ind + data$ServSat_Grp + data$ServSat_Inp + data$ServSat_Cri > 0))
which(data$Service == 2 & (data$ServSat_Med + data$ServSat_Ind + data$ServSat_Grp + data$ServSat_Inp + data$ServSat_Cri== 0))
check <- data %>%
mutate(
qc_idx = 0, #set initial value
#total time length
qc_idx = ifelse(TimeComplete < 600, qc_idx + 1, qc_idx),
#wrong pattern of PHQ
qc_idx = ifelse(PHQ_sum == 0 & PHQ10 != 999, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum > 0 & PHQ10 == 999, qc_idx + 1, qc_idx),
#wrong pattern of PSS
PSS_dif = (PSS1 + PSS2 + PSS3 + PSS4 + PSS5 + PSS6) / 6 - (PSS7 + PSS8 + PSS9 + PSS10) / 4,
qc_idx = ifelse(abs(PSS_dif - mean(PSS_dif)) > 3*sd(PSS_dif), qc_idx + 0.5, qc_idx),
#violate MH usage and satisfaction
qc_idx = ifelse(Service == 2 & (ServSat_Med + ServSat_Ind + ServSat_Grp + ServSat_Inp + ServSat_Cri > 0) , qc_idx + 1, qc_idx)
#没有使用心理咨询等服务却选了满意度（没有选“不适用”）。
#C5 age match
#6 29.7 (QLES2) high should correspond to -> 28b1-6 low
#7 29.8 (QLES3) high should correspond to -> 29.1-5 high
#8 29.8 (QLES3) high should correspond to -> 29.6-7 medium to high
)
summary(check$qc_idx)
data_vis <- data %>%
mutate(age_grp = ifelse(Age >= 25, "25+", "below25"),
gender_grp = ifelse(Gender == 1, "Male",
ifelse(Gender == 2, "Female",
ifelse(Gender < 667, "Spectrum", NA))),
degree_grp = ifelse(Degree == 1, "本科",
ifelse(Degree == 2, "硕士",
ifelse(Degree == 3, "MBA",
ifelse(Degree == 4, "博士", NA)))),
religion_grp = ifelse(Religion %in% c(1,2,3,4,5), "教",
ifelse(Religion == 6, "无宗教信仰", NA)),
gpa_grp = ifelse(GPA == 1, "a.3.8+",
ifelse(GPA == 2, "b.3.5-3.8",
ifelse(GPA == 3, "c.3.3-3.5",
ifelse(GPA == 4, "d.3.0-3.3",
ifelse(GPA == 5, "e.3-", NA))))),
gpa_change_grp = ifelse(GradeChange == 1, "a明显变好",
ifelse(GradeChange == 2, "b变好",
ifelse(GradeChange == 3, "c不变",
ifelse(GradeChange == 4, "d变差",
ifelse(GradeChange == 5, "e明显变差", NA))))),
#sometime
time_new = ymd_hms(TimeSubmit), time_day = date(TimeSubmit),
ICE = ifelse(time_new <= as.POSIXct("2020-07-06 03"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE"))
)
data_vis <- data %>%
mutate(age_grp = ifelse(Age >= 25, "25+", "below25"),
gender_grp = ifelse(Gender == 1, "Male",
ifelse(Gender == 2, "Female",
ifelse(Gender < 667, "Spectrum", NA))),
degree_grp = ifelse(Degree == 1, "本科",
ifelse(Degree == 2, "硕士",
ifelse(Degree == 3, "MBA",
ifelse(Degree == 4, "博士", NA)))),
religion_grp = ifelse(Religion %in% c(1,2,3,4,5), "教",
ifelse(Religion == 6, "无宗教信仰", NA)),
gpa_grp = ifelse(GPA == 1, "a.3.8+",
ifelse(GPA == 2, "b.3.5-3.8",
ifelse(GPA == 3, "c.3.3-3.5",
ifelse(GPA == 4, "d.3.0-3.3",
ifelse(GPA == 5, "e.3-", NA))))),
gpa_change_grp = ifelse(GradeChange == 1, "a明显变好",
ifelse(GradeChange == 2, "b变好",
ifelse(GradeChange == 3, "c不变",
ifelse(GradeChange == 4, "d变差",
ifelse(GradeChange == 5, "e明显变差", NA))))),
#sometime
time_new = ymd_hms(TimeSubmit),
ICE = ifelse(time_new <= as.POSIXct("2020-07-06 03"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14 03"), "postICE", "duringICE"))
) %>%
select(time_new, ICE)
View(data_vis)
data_vis <- data %>%
mutate(age_grp = ifelse(Age >= 25, "25+", "below25"),
gender_grp = ifelse(Gender == 1, "Male",
ifelse(Gender == 2, "Female",
ifelse(Gender < 667, "Spectrum", NA))),
degree_grp = ifelse(Degree == 1, "本科",
ifelse(Degree == 2, "硕士",
ifelse(Degree == 3, "MBA",
ifelse(Degree == 4, "博士", NA)))),
religion_grp = ifelse(Religion %in% c(1,2,3,4,5), "教",
ifelse(Religion == 6, "无宗教信仰", NA)),
gpa_grp = ifelse(GPA == 1, "a.3.8+",
ifelse(GPA == 2, "b.3.5-3.8",
ifelse(GPA == 3, "c.3.3-3.5",
ifelse(GPA == 4, "d.3.0-3.3",
ifelse(GPA == 5, "e.3-", NA))))),
gpa_change_grp = ifelse(GradeChange == 1, "a明显变好",
ifelse(GradeChange == 2, "b变好",
ifelse(GradeChange == 3, "c不变",
ifelse(GradeChange == 4, "d变差",
ifelse(GradeChange == 5, "e明显变差", NA))))),
#sometime
time_new = ymd_hms(TimeSubmit),
ICE = ifelse(time_new <= as.POSIXct("2020-07-06 03"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14 03"), "postICE", "duringICE"))
)
data_vis <- data %>%
mutate(age_grp = ifelse(Age >= 25, "25+", "below25"),
gender_grp = ifelse(Gender == 1, "Male",
ifelse(Gender == 2, "Female",
ifelse(Gender < 667, "Spectrum", NA))),
degree_grp = ifelse(Degree == 1, "本科",
ifelse(Degree == 2, "硕士",
ifelse(Degree == 3, "MBA",
ifelse(Degree == 4, "博士", NA)))),
religion_grp = ifelse(Religion %in% c(1,2,3,4,5), "教",
ifelse(Religion == 6, "无宗教信仰", NA)),
gpa_grp = ifelse(GPA == 1, "a.3.8+",
ifelse(GPA == 2, "b.3.5-3.8",
ifelse(GPA == 3, "c.3.3-3.5",
ifelse(GPA == 4, "d.3.0-3.3",
ifelse(GPA == 5, "e.3-", NA))))),
gpa_change_grp = ifelse(GradeChange == 1, "a明显变好",
ifelse(GradeChange == 2, "b变好",
ifelse(GradeChange == 3, "c不变",
ifelse(GradeChange == 4, "d变差",
ifelse(GradeChange == 5, "e明显变差", NA))))),
#sometime
time_new = ymd_hms(TimeSubmit),
ICE = ifelse(time_new <= as.POSIXct("2020-07-06 04"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14 04"), "postICE", "duringICE"))
)
ggplot(data_date, aes(y = PSS_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 3)
ggplot(data_vis, aes(y = PSS_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 3)
data_vis <- data %>%
mutate(age_grp = ifelse(Age >= 25, "25+", "below25"),
gender_grp = ifelse(Gender == 1, "Male",
ifelse(Gender == 2, "Female",
ifelse(Gender < 667, "Spectrum", NA))),
degree_grp = ifelse(Degree == 1, "本科",
ifelse(Degree == 2, "硕士",
ifelse(Degree == 3, "MBA",
ifelse(Degree == 4, "博士", NA)))),
religion_grp = ifelse(Religion %in% c(1,2,3,4,5), "教",
ifelse(Religion == 6, "无宗教信仰", NA)),
gpa_grp = ifelse(GPA == 1, "a.3.8+",
ifelse(GPA == 2, "b.3.5-3.8",
ifelse(GPA == 3, "c.3.3-3.5",
ifelse(GPA == 4, "d.3.0-3.3",
ifelse(GPA == 5, "e.3-", NA))))),
gpa_change_grp = ifelse(GradeChange == 1, "a明显变好",
ifelse(GradeChange == 2, "b变好",
ifelse(GradeChange == 3, "c不变",
ifelse(GradeChange == 4, "d变差",
ifelse(GradeChange == 5, "e明显变差", NA))))),
#sometime
time_new = ymd_hms(TimeSubmit), time_day = as.Date(TimeSubmit),
ICE = ifelse(time_new <= as.POSIXct("2020-07-06 04"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14 04"), "postICE", "duringICE"))
)
ggplot(data_vis, aes(y = PSS_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 3)
table_test <- tableby(ICE ~ PHQ_sum + GAD_sum + PSS_sum + SWLS_sum + QLES_sum + SCOFF_nervosa, data = data_date)
table_test <- tableby(ICE ~ PHQ_sum + GAD_sum + PSS_sum + SWLS_sum + QLES_sum + SCOFF_nervosa, data = data_vis)
summary(table_test, title = "test", text = TRUE)
data_vis_short <- data_vis %>% select(PSS_sum, PHQ_sum, GAD_sum, SCOFF_nervosa, SWLS_sum, QLES_sum, ERQ_reap, ERQ_sup, GSE_sum, MEMS, SSSI_avg)
pairs.panels(data_vis_short,
method = "pearson", # correlation method
hist.col = "#00AFBB",
density = TRUE,  # show density plots
ellipses = TRUE # show correlation ellipses
)
data_vis_short <- data_vis %>% select(PSS_sum, PHQ_sum, GAD_sum, SCOFF_nervosa, SWLS_sum, QLES_sum, GSE_sum, MEMS, SSSI_avg)
data_vis_short <- data_vis %>% select(PSS_sum, PHQ_sum, GAD_sum, SCOFF_nervosa, SWLS_sum, QLES_sum, GSE_sum, MEMS, SSSI_avg)
data_vis_short <- data_vis %>% select(PSS_sum, PHQ_sum, GAD_sum, SCOFF_nervosa, SWLS_sum, QLES_sum, GSE_sum, MEMS, SSSI_avg)
pairs.panels(data_vis_short,
method = "pearson", # correlation method
hist.col = "#00AFBB",
density = TRUE,  # show density plots
ellipses = TRUE # show correlation ellipses
)
ggplot(data_vis_pwb, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr")
#gather and spread
data_vis_pwb <- data_vis %>%
gather(PWB, PWB_val, PSS_sum:QLES_sum)
data_vis_lt <- data_vis %>%
gather(Latent, Lt_val, c(ERQ_reap:MEMS, SSSI_avg))
ggplot(data_vis_pwb, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr")
ggplot(data_vis_lt, aes(y = Lt_val, x = Latent, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr")
data_vis_lt_sum <- summarySE(data_vis_lt, measurevar="Lt_val", groupvars=c("Latent","ICE"))
??summarySE
data_vis_lt_sum <- data_summary(data_vis_lt, varname="Lt_val",
groupnames=c("Latent", "ICE"))
data_summary <- function(data, varname, groupnames){
require(plyr)
summary_func <- function(x, col){
c(mean = mean(x[[col]], na.rm=TRUE),
sd = sd(x[[col]], na.rm=TRUE))
}
data_sum<-ddply(data, groupnames, .fun=summary_func,
varname)
data_sum <- rename(data_sum, c("mean" = varname))
return(data_sum)
}
data_vis_lt_sum <- data_summary(data_vis_lt, varname="Lt_val",
groupnames=c("Latent", "ICE"))
library(plyr)
data_summary <- function(data, varname, groupnames){
require(plyr)
summary_func <- function(x, col){
c(mean = mean(x[[col]], na.rm=TRUE),
sd = sd(x[[col]], na.rm=TRUE))
}
data_sum<-ddply(data, groupnames, .fun=summary_func,
varname)
data_sum <- rename(data_sum, c("mean" = varname))
return(data_sum)
}
data_vis_lt_sum <- data_summary(data_vis_lt, varname="Lt_val",
groupnames=c("Latent", "ICE"))
ggplot(data_vis_lt_sum, aes(y = Lt_val, x = Latent, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr")+
geom_errorbar(aes(ymin=Lt_val-sd, ymax=Lt_val+sd), width=.2,
position=position_dodge(.9))
ggplot(data_vis_lt_sum, aes(y = Lt_val, x = Latent, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr")+
geom_errorbar(aes(ymin=Lt_val-sd, ymax=Lt_val+sd), width=.1,
position=position_dodge(.9))
ggplot(data_vis_lt_sum, aes(y = Lt_val, x = Latent, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr")+
geom_errorbar(aes(ymin=Lt_val-sd, ymax=Lt_val+sd), width=.1, alpha = .3
position=position_dodge(.9))
ggplot(data_vis_lt_sum, aes(y = Lt_val, x = Latent, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr")+
geom_errorbar(aes(ymin=Lt_val-sd, ymax=Lt_val+sd), width=.1, alpha = 0.1, position=position_dodge(.9))
ggplot(data_vis_lt_sum, aes(y = Lt_val, x = Latent, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr")+
geom_errorbar(aes(ymin=Lt_val-sd, ymax=Lt_val+sd), width=.1, alpha = 0.3, position=position_dodge(.9))
data_vis_pwb_sum <- data_summary(data_vis_pwb, varname="PWB_val", groupnames=c("PWB", "ICE"))
ggplot(data_vis_pwb_sum, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr") +
geom_errorbar(aes(ymin=PWB_val-sd, ymax=PWB_val+sd), width=.1, alpha = 0.3, position=position_dodge(.9))
se(data_vis_pwb$PWB_val)
data_summary <- function(data, varname, groupnames){
require(plyr)
summary_func <- function(x, col){
c(mean = mean(x[[col]], na.rm=TRUE),
sd = sd(x[[col]], na.rm=TRUE),
se = sqrt(var(x[[col]], na.rm=TRUE) / length(x[[col]], na.rm=TRUE)))
}
data_sum<-ddply(data, groupnames, .fun=summary_func,
varname)
data_sum <- rename(data_sum, c("mean" = varname))
return(data_sum)
}
data_vis_pwb_sum <- data_summary(data_vis_pwb, varname="PWB_val", groupnames=c("PWB", "ICE"))
c(mean = mean(x[[col]], na.rm=TRUE),
sd = sd(x[[col]], na.rm=TRUE),
se = sqrt(var(x[[col]], na.rm=TRUE) / length(x[[col]])))
data_summary <- function(data, varname, groupnames){
require(plyr)
summary_func <- function(x, col){
c(mean = mean(x[[col]], na.rm=TRUE),
sd = sd(x[[col]], na.rm=TRUE),
se = sqrt(var(x[[col]], na.rm=TRUE) / length(x[[col]])))
}
data_sum<-ddply(data, groupnames, .fun=summary_func,
varname)
data_sum <- rename(data_sum, c("mean" = varname))
return(data_sum)
}
data_vis_pwb_sum <- data_summary(data_vis_pwb, varname="PWB_val", groupnames=c("PWB", "ICE"))
ggplot(data_vis_pwb_sum, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr") +
geom_errorbar(aes(ymin=PWB_val-sd, ymax=PWB_val+sd), width=.1, alpha = 0.3, position=position_dodge(.9))
ggplot(data_vis_pwb_sum, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr") +
geom_errorbar(aes(ymin=PWB_val-se, ymax=PWB_val+se), width=.1, alpha = 0.3, position=position_dodge(.9))
ggplot(data_vis_pwb_sum, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr") +
geom_errorbar(aes(ymin=PWB_val-se, ymax=PWB_val+se), width=.1, alpha = 0.5, position=position_dodge(.9))
