library(dplyr)
library(tidyr)
library(data.table)
library(naniar)
library(stringr)
library(maps)
library(mapdata)
library(arsenal)
library(ggcorrplot)
library(ggplot2)
data <- read.csv("~/Documents/2020_2Summer/research/0Yale2009/data/output/bps_df0722_xm0722.csv", comment.char="#", encoding = "UTF-8")
head(data)
data_vis <- data %>%
mutate(age_grp = ifelse(Age >= 25, "25+", "below25"),
gender_grp = ifelse(Gender == 1, "Male",
ifelse(Gender == 2, "Female",
ifelse(Gender < 667, "Spectrum", NA))),
degree_grp = ifelse(Degree == 1, "本科",
ifelse(Degree == 2, "硕士",
ifelse(Degree == 3, "MBA",
ifelse(Degree == 4, "博士", NA)))),
religion_grp = ifelse(Religion %in% c(1,2,3,4,5), "教",
ifelse(Religion == 6, "无宗教信仰", NA)),
gpa_grp = ifelse(GPA == 1, "a.3.8+",
ifelse(GPA == 2, "b.3.5-3.8",
ifelse(GPA == 3, "c.3.3-3.5",
ifelse(GPA == 4, "d.3.0-3.3",
ifelse(GPA == 5, "e.3-", NA))))),
gpa_change_grp = ifelse(GradeChange == 1, "a明显变好",
ifelse(GradeChange == 2, "b变好",
ifelse(GradeChange == 3, "c不变",
ifelse(GradeChange == 4, "d变差",
ifelse(GradeChange == 5, "e明显变差", NA))))),
)
#need to summarize data first to get error bar
hist(data_vis$PSS_sum)
View(data_vis)
table_y1 <- tableby(age_grp ~ PHQ_sum, data = data_vis)
summary(table_y1, title = "demo By Service", text = TRUE)
table_y1 <- tableby(age_grp ~ GAD_sum, data = data_vis)
summary(table_y1, title = "demo By Service", text = TRUE)
table_y1 <- tableby(age_grp ~ GAD_sum + PHQ_sum, data = data_vis)
summary(table_y1, title = "demo By Service", text = TRUE)
table_y1 <- tableby(gender_grp ~ GAD_sum + PHQ_sum, data = data_vis)
summary(table_y1, title = "demo By Service", text = TRUE)
table_y1 <- tableby(religion_grp ~ GAD_sum + PHQ_sum, data = data_vis)
summary(table_y1, title = "demo By Service", text = TRUE)
table_y1 <- tableby(religion_grp + gender_grp ~ GAD_sum + PHQ_sum, data = data_vis)
typeof(data_vis$TimeSubmit)
head(data_vis$TimeSubmit)
library(lubridate)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit))
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
select(time_new, TimeSubmit)
head(data_date)
data_date <- data_vis %>%
mutate(time_new = ymd(TimeSubmit)) %>%
select(time_new, TimeSubmit)
head(data_date)
data_date <- data_vis %>%
mutate(time_new = ymd(TimeSubmit)) %>%
select(time_new, TimeSubmit)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
select(time_new, TimeSubmit) %>%
arrange(desc(time_new))
head(data_date)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
select(time_new, TimeSubmit) %>%
arrange(desc(time_new)) %>%
filter(time_new >= as.Date("2020-07-06") & time_new <= as.Date("2020-07-14"))
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
select(time_new, TimeSubmit) %>%
filter(time_new >= as.Date("2020-07-06") & time_new <= as.Date("2020-07-14"))
head(data_date)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
mutate(ICE = ifelse(time_new <= as.Date("2020-07-06"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE")))
head(data_date)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
mutate(ICE = ifelse(time_new <= as.Date("2020-07-06"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE"))) %>%
gather(PWB, PWB_val, PSS_sum:QLES_sum)
head(data_date)
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="Set3"))
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="Set3")
ggplot(data_date, aes(y = PHQ_sum, x = time_new))+ geom_point()
ggplot(data_vis, aes(y = PHQ_sum, x = TimeSubmit))+ geom_point()
ggplot(data_vis, aes(y = PHQ_sum, x = TimeSubmit)) + geom_count() + scale_size_area(max_size = 1)
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="Set3")
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="Greys")
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YIGn")
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlGn")
ggplot(data_date, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBr")
table_test <- tableby(ICE ~ PHQ_sum + GAD_sum + PSS_sum + SWLS_sum + QLES_sum + SCOFF_nervosa, data = data_vis)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit)) %>%
mutate(ICE = ifelse(time_new <= as.Date("2020-07-06"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE")))
data_date_g <- data_date %>%
gather(PWB, PWB_val, PSS_sum:QLES_sum)
table_test <- tableby(ICE ~ PHQ_sum + GAD_sum + PSS_sum + SWLS_sum + QLES_sum + SCOFF_nervosa, data = data_date_g)
ggplot(data_vis, aes(y = PHQ_sum, x = TimeSubmit)) + geom_count() + scale_size_area(max_size = 1)
table_test <- tableby(ICE ~ PHQ_sum + GAD_sum + PSS_sum + SWLS_sum + QLES_sum + SCOFF_nervosa, data = data_date_g)
summary(table_test, title = "test", text = TRUE)
table_test <- tableby(ICE ~ PHQ_sum + GAD_sum + PSS_sum + SWLS_sum + QLES_sum + SCOFF_nervosa, data = data_date)
summary(table_test, title = "test", text = TRUE)
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit), time_day = ymd(TimeSubmit)) %>%
mutate(ICE = ifelse(time_new <= as.Date("2020-07-06"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE")))
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit), time_day = day(TimeSubmit)) %>%
mutate(ICE = ifelse(time_new <= as.Date("2020-07-06"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE")))
head(time_day)
ggplot(data_date_g, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlOrBu")
ggplot(data_date_g, aes(y = PWB_val, x = PWB, fill = ICE))+ geom_bar(stat="summary", position = "dodge", fun = mean) + scale_fill_brewer(palette="YlGnBu")
data_date <- data_vis %>%
mutate(time_new = ymd_hms(TimeSubmit), time_day = date(TimeSubmit)) %>%
mutate(ICE = ifelse(time_new <= as.Date("2020-07-06"), "beforeICE",
ifelse(time_new >= as.Date("2020-07-14"), "postICE", "duringICE")))
head(time_day)
head(data_date)
ggplot(data_date, aes(y = PHQ_sum, x = time_day)) + geom_count() + scale_size_area(max_size = 1)
ggplot(data_date, aes(y = PHQ_sum, x = time_day)) + geom_count() + scale_size_area(max_size = 3)
ggplot(data_date, aes(y = PHQ_sum, x = time_day)) + geom_count() + scale_size_area(max_size = 3) + geom_vline(xintercept = 5)
ggplot(data_date, aes(y = PHQ_sum, x = time_day, fill = ICE)) + geom_count() + scale_size_area(max_size = 3)
ggplot(data_date, aes(y = PHQ_sum, x = time_day, fill = ICE)) + geom_count() + scale_size_area(max_size = 3) + scale_fill_brewer(palette="YlOrBr")
ggplot(data_date, aes(y = PHQ_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 3) + scale_fill_brewer(palette="YlOrBr")
ggplot(data_date, aes(y = PHQ_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 4)
ggplot(data_date, aes(y = QLES_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 4)
ggplot(data_date, aes(y = QLES_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 2.5)
ggplot(data_date, aes(y = QLES_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 3)
ggplot(data_date, aes(y = PSS_sum, x = time_day, color = as.factor(ICE))) + geom_count() + scale_size_area(max_size = 3)
head(data$TimeComplete)
check <- data %>%
mutate(
qc_idx = 0,
qc_idx = ifelse(TimeComplete < 600, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum == 0 & PHQ10 != 999, qc_idx + 1, qc_idx),
qc_idx = ifelse(PHQ_sum > 0 & PHQ10 == 999, qc_idx + 1, qc_idx)
#没有使用心理咨询等服务却选了满意度（没有选“不适用”）。
#C5 age match
#6 29.7 (QLES2) high should correspond to -> 28b1-6 low
#7 29.8 (QLES3) high should correspond to -> 29.1-5 high
#8 29.8 (QLES3) high should correspond to -> 29.6-7 medium to high
)
summary(check$qc_idx)
which(check$qc_idx == 2)
which(check$qc_idx > 0)
